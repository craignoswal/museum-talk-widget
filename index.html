<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Talk</title>

    <style>
      html, body {
        margin: 0;
        height: 100%;
        background: #fff;
      }
      #wrap {
        width: 100vw;
        height: 100vh;
      }
      elevenlabs-convai {
        display: block;
        width: 100%;
        height: 100%;
      }
      /* Simple fallback styling if agent_id is missing */
      #error {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        padding: 16px;
      }
    </style>
  </head>

  <body>
    <div id="wrap">
      <elevenlabs-convai id="el-widget"></elevenlabs-convai>
    </div>

    <script>
      const params = new URLSearchParams(window.location.search);

      const agentId = params.get("agent_id");
      const voiceId = params.get("voice_id");
      const title = params.get("title");
      const artist = params.get("artist");

      const widget = document.getElementById("el-widget");

      if (!agentId) {
        document.body.innerHTML =
          "<div id='error'><h2>Missing agent_id</h2><p>Add <code>?agent_id=...</code> to the URL.</p></div>";
      } else {
        widget.setAttribute("agent-id", agentId);

        // Optional: per-artwork voice override
        if (voiceId) widget.setAttribute("override-voice-id", voiceId);

        // Optional: pass context into the agent as dynamic variables
        const dyn = {};
        if (title) dyn.title = title;
        if (artist) dyn.artist = artist;
        widget.setAttribute("dynamic-variables", JSON.stringify(dyn));

        // Optional: allow links in markdown
        widget.setAttribute("markdown-link-allowed-hosts", "*");
      }
    </script>

    <script
      src="https://unpkg.com/@elevenlabs/convai-widget-embed"
      async
      type="text/javascript"
    ></script>
  </body>
</html>
